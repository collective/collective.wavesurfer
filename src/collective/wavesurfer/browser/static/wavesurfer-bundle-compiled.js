define("pat-parser",["jquery","underscore","pat-utils","pat-logger"],function(h,c,l,i){"use strict";function n(t,e){this.order=[],this.parameters={},this.attribute="data-pat-"+t,this.enum_values={},this.enum_conflicts=[],this.groups={},this.possible_groups={},this.log=i.getLogger(t+".parser")}return(n.prototype={group_pattern:/([a-z][a-z0-9]*)-([A-Z][a-z0-0\-]*)/i,json_param_pattern:/^\s*{/i,named_param_pattern:/^\s*([a-z][a-z0-9\-]*)\s*:(.*)/i,token_pattern:/((["']).*?(?!\\)\2)|\s*(\S+)\s*/g,_camelCase:function(t){return t.replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()})},addAlias:function(t,e){if(!this.parameters[e])throw'Attempted to add an alias "'+t+'" for a non-existing parser argument "'+e+'".';this.parameters[e].alias=t},addGroupToSpec:function(t){var e,i,a,s,r=t.name.match(this.group_pattern);return r&&(e=r[1],i=r[2],e in this.possible_groups&&(s=(a=this.possible_groups[e]).name.match(this.group_pattern)[2],a.group=e,a.dest=s,this.groups[e]=new n,this.groups[e].addArgument(s,a.value,a.choices,a.multiple),delete this.possible_groups[e]),e in this.groups?(this.groups[e].addArgument(i,t.value,t.choices,t.multiple),t.group=e,t.dest=i):(this.possible_groups[e]=t).dest=this._camelCase(t.name)),t},addJSONArgument:function(t,e){this.order.push(t),this.parameters[t]=this.addGroupToSpec({name:t,value:e,dest:t,group:null,type:"json"})},addArgument:function(t,e,i,a){var s={name:t,value:a&&!Array.isArray(e)?[e]:e,multiple:a,dest:t,group:null};if(i&&Array.isArray(i)&&i.length){s.choices=i,s.type=this._typeof(i[0]);for(var r=0;r<i.length;r++)-1===this.enum_conflicts.indexOf(i[r])&&(i[r]in this.enum_values?(this.enum_conflicts.push(i[r]),delete this.enum_values[i[r]]):this.enum_values[i[r]]=t)}else"string"==typeof s.value&&"$"===s.value.slice(0,1)?s.type=this.parameters[s.value.slice(1)].type:s.type=this._typeof(a?s.value[0]:s.value);this.order.push(t),this.parameters[t]=this.addGroupToSpec(s)},_typeof:function(t){return null===t?"null":typeof t},_coerce:function(t,e){var i=this.parameters[t];if(typeof e!==i.type)try{switch(i.type){case"json":e=JSON.parse(e);break;case"boolean":if("string"==typeof e){e=e.toLowerCase();var a=parseInt(e,10);e=isNaN(a)?"true"===e||"y"===e||"yes"===e||"y"===e:!!a}else{if("number"!=typeof e)throw"Cannot convert value for "+t+" to boolean";e=!!e}break;case"number":if("string"==typeof e){if(e=parseInt(e,10),isNaN(e))throw"Cannot convert value for "+t+" to number"}else{if("boolean"!=typeof e)throw"Cannot convert value for "+t+" to number";e+=0}break;case"string":e=e.toString();break;case"null":case"undefined":break;default:throw"Do not know how to convert value for "+t+" to "+i.type}}catch(t){return this.log.warn(t),null}return i.choices&&-1===i.choices.indexOf(e)?(this.log.warn("Illegal value for "+t+": "+e),null):e},_set:function(t,e,i){if(e in this.parameters){var a,s,r;if(this.parameters[e].multiple)for(a="string"==typeof i?i.split(/,+/):i,i=[],s=0;s<a.length;s++)null!==(r=this._coerce(e,a[s].trim()))&&i.push(r);else if(null===(i=this._coerce(e,i)))return;t[e]=i}else this.log.debug("Ignoring value for unknown argument "+e)},_split:function(t){var s=[];return t.replace(this.token_pattern,function(t,e,i,a){e?s.push(e):a&&s.push(a)}),s},_parseExtendedNotation:function(h){var l={},t=h.replace(/;;/g,"\0x1f").replace(/&amp;/g,"&amp\0x1f").split(/;/).map(function(t){return t.replace(new RegExp("\0x1f","g"),";")});return c.each(t,function(t,e){if(t){var i=t.match(this.named_param_pattern);if(i){var a=i[1],s=i[2].trim(),r=c.chain(this.parameters).where({alias:a}).value();if(1===r.length)this._set(l,r[0].name,s);else if(a in this.parameters)this._set(l,a,s);else{if(!(a in this.groups))return void this.log.warn("Unknown named parameter "+i[1]);var n=this.groups[a]._parseShorthandNotation(s);for(var o in n)this._set(l,a+"-"+o,n[o])}}else this.log.warn("Invalid parameter: "+t+": "+h)}}.bind(this)),l},_parseShorthandNotation:function(t){for(var e,i,a,s=this._split(t),r={},n=!0,o=0;s.length;){if((i="no-"===(e=s.shift().trim()).slice(0,3)?(a=!1,e.slice(3)):(a=!0,e))in this.parameters&&"boolean"===this.parameters[i].type)n=!1,this._set(r,i,a);else if(i in this.enum_values)n=!1,this._set(r,this.enum_values[i],i);else{if(!n){s.unshift(e);break}this._set(r,this.order[o],e)}if(++o>=this.order.length)break}return s.length&&this.log.warn("Ignore extra arguments: "+s.join(" ")),r},_parse:function(e){var t,i,a;if(!e)return{};if(e.match(this.json_param_pattern))try{return JSON.parse(e)}catch(t){this.log.warn("Invalid JSON argument found: "+e)}if(e.match(this.named_param_pattern))return this._parseExtendedNotation(e);if(-1===(a=e.indexOf(";")))return this._parseShorthandNotation(e);for(var s in t=this._parseShorthandNotation(e.slice(0,a)),i=this._parseExtendedNotation(e.slice(a+1)))t[s]=i[s];return t},_defaults:function(t){var e={};for(var i in this.parameters)if("function"==typeof this.parameters[i].value)try{e[i]=this.parameters[i].value(t,i),this.parameters[i].type=typeof e[i]}catch(t){this.log.error("Default function for "+i+" failed.")}else e[i]=this.parameters[i].value;return e},_cleanupOptions:function(t){for(var e,i,a,s=Object.keys(t),r=0;r<s.length;r++)i=s[r],void 0!==(e=this.parameters[i])&&t[i]===e.value&&"string"==typeof e.value&&"$"===e.value.slice(0,1)&&(t[i]=t[e.value.slice(1)]);for(s=Object.keys(t),r=0;r<s.length;r++)i=s[r],void 0!==(e=this.parameters[i])&&(a=e.group?("object"!=typeof t[e.group]&&(t[e.group]={}),t[e.group]):t,e.dest!==i&&(a[e.dest]=t[i],delete t[i]));return t},parse:function(t,e,i,a){"boolean"==typeof e&&void 0===i&&(i=e,e={});var s=(a=!1!==a)?[[this._defaults(t)]]:[[{}]],r=a?t.parents().andSelf():t,n=1;c.each(r,function(t){var e,i,a=h(t).attr(this.attribute);a&&(i=this._parse.bind(this),e=a.match(/&&/)?a.split(/\s*&&\s*/).map(i):[i(a)],n=Math.max(e.length,n),s.push(e))}.bind(this)),"object"==typeof e&&(Array.isArray(e)?(s.push(e),n=Math.max(e.length,n)):s.push([e])),i||(n=1);var o=c.map(c.compose(l.removeDuplicateObjects,c.partial(l.mergeStack,c,n))(s),this._cleanupOptions.bind(this));return i?o:o[0]}}).add_argument=n.prototype.addArgument,n}),function(t,e){"function"==typeof define&&define.amd?define("wavesurfer",[],function(){return t.WaveSurfer=e()}):"object"==typeof exports?module.exports=e():t.WaveSurfer=e()}(this,function(){var C={defaultParams:{audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,closeAudioContext:!1,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:!1,renderer:"MultiCanvas",scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999"},init:function(t){if(this.params=C.util.extend({},this.defaultParams,t),this.container="string"==typeof t.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(null==this.params.mediaContainer?this.mediaContainer=this.container:"string"==typeof this.params.mediaContainer?this.mediaContainer=document.querySelector(this.params.mediaContainer):this.mediaContainer=this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.currentAjax=null,this.createDrawer(),this.createBackend(),this.createPeakCache(),this.isDestroyed=!1},createDrawer:function(){var i=this;this.drawer=Object.create(C.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){i.drawBuffer(),i.drawer.progress(i.backend.getPlayedPercents())}),this.drawer.on("click",function(t,e){setTimeout(function(){i.seekTo(e)},0)}),this.drawer.on("scroll",function(t){i.params.partialRender&&i.drawBuffer(),i.fireEvent("scroll",t)})},createBackend:function(){var e=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||C.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(C[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){e.fireEvent("finish")}),this.backend.on("play",function(){e.fireEvent("play")}),this.backend.on("pause",function(){e.fireEvent("pause")}),this.backend.on("audioprocess",function(t){e.drawer.progress(e.backend.getPlayedPercents()),e.fireEvent("audioprocess",t)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(C.PeakCache),this.peakCache.init())},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(t,e){this.fireEvent("interaction",this.play.bind(this,t,e)),this.backend.play(t,e)},pause:function(){this.backend.isPaused()||this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(t){this.skip(-t||-this.params.skipLength)},skipForward:function(t){this.skip(t||this.params.skipLength)},skip:function(t){var e=this.getCurrentTime()||0,i=this.getDuration()||1,e=Math.max(0,Math.min(i,e+(t||0)));this.seekAndCenter(e/i)},seekAndCenter:function(t){this.seekTo(t),this.drawer.recenter(t)},seekTo:function(t){this.fireEvent("interaction",this.seekTo.bind(this,t));var e=this.backend.isPaused();e||this.backend.pause();var i=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(t*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),e||this.backend.play(),this.params.scrollParent=i,this.fireEvent("seek",t)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(t){this.backend.setVolume(t)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(t){this.backend.setPlaybackRate(t)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(t){t!==this.isMuted&&(t?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),e=this.drawer.getWidth(),i=t,a=this.drawer.getScrollX(),s=Math.min(a+e,i);if(this.params.fillParent&&(!this.params.scrollParent||t<e)&&(a=0,s=i=e),this.params.partialRender)for(var r=this.peakCache.addRangeToPeakCache(i,a,s),n=0;n<r.length;n++){var o=this.backend.getPeaks(i,r[n][0],r[n][1]);this.drawer.drawPeaks(o,i,r[n][0],r[n][1])}else{a=0,s=i;o=this.backend.getPeaks(i,a,s);this.drawer.drawPeaks(o,i,a,s)}this.fireEvent("redraw",o,i)},zoom:function(t){this.params.minPxPerSec=t,this.params.scrollParent=!0,this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",t)},loadArrayBuffer:function(t){this.decodeArrayBuffer(t,function(t){this.isDestroyed||this.loadDecodedBuffer(t)}.bind(this))},loadDecodedBuffer:function(t){this.backend.load(t),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(t){var e=this,i=new FileReader;i.addEventListener("progress",function(t){e.onProgress(t)}),i.addEventListener("load",function(t){e.loadArrayBuffer(t.target.result)}),i.addEventListener("error",function(){e.fireEvent("error","Error reading file")}),i.readAsArrayBuffer(t),this.empty()},load:function(t,e,i){switch(this.empty(),this.isMuted=!1,this.params.backend){case"WebAudio":return this.loadBuffer(t,e);case"MediaElement":return this.loadMediaElement(t,e,i)}},loadBuffer:function(e,t){var i=function(t){return t&&this.tmpEvents.push(this.once("ready",t)),this.getArrayBuffer(e,this.loadArrayBuffer.bind(this))}.bind(this);if(!t)return i();this.backend.setPeaks(t),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",i))},loadMediaElement:function(t,e,i){var a,s=t;"string"==typeof t?this.backend.load(s,this.mediaContainer,e,i):(a=t,this.backend.loadElt(a,e),s=a.src),this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(t){this.fireEvent("error",t)}.bind(this))),e&&this.backend.setPeaks(e),e&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(s,function(t){this.decodeArrayBuffer(t,function(t){this.backend.buffer=t,this.backend.setPeaks(null),this.drawBuffer(),this.fireEvent("waveform-ready")}.bind(this))}.bind(this))},decodeArrayBuffer:function(e,i){this.arraybuffer=e,this.backend.decodeArrayBuffer(e,function(t){this.isDestroyed||this.arraybuffer!=e||(i(t),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(t,i){var a=this,e=C.util.ajax({url:t,responseType:"arraybuffer"});return this.currentAjax=e,this.tmpEvents.push(e.on("progress",function(t){a.onProgress(t)}),e.on("success",function(t,e){i(t),a.currentAjax=null}),e.on("error",function(t){a.fireEvent("error","XHR error: "+t.target.statusText),a.currentAjax=null})),e},onProgress:function(t){var e=t.lengthComputable?t.loaded/t.total:t.loaded/(t.loaded+1e6);this.fireEvent("loading",Math.round(100*e),t.target)},exportPCM:function(t,e,i){t=t||1024,e=e||1e4,i=i||!1;var a=this.backend.getPeaks(t,e),s=[].map.call(a,function(t){return Math.round(t*e)/e}),r=JSON.stringify(s);return i||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(r)),r},exportImage:function(t,e){return t=t||"image/png",e=e||1,this.drawer.getImage(t,e)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(t){t.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0}};function t(){var t=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(t,function(t){var e=C.util.extend({container:t,backend:"MediaElement",mediaControls:!0},t.dataset);t.style.display="block";var i,a=C.create(e);t.dataset.peaks&&(i=JSON.parse(t.dataset.peaks)),a.load(t.dataset.url,i)})}return C.create=function(t){var e=Object.create(C);return e.init(t),e},C.util={extend:function(i){return Array.prototype.slice.call(arguments,1).forEach(function(e){Object.keys(e).forEach(function(t){i[t]=e[t]})}),i},debounce:function(e,i,a){function s(){o=null,a||e.apply(n,r)}var r,n,o;return function(){n=this,r=arguments;var t=a&&!o;clearTimeout(o),o=(o=setTimeout(s,i))||setTimeout(s,i),t&&e.apply(n,r)}},min:function(t){var e=1/0;for(var i in t)t[i]<e&&(e=t[i]);return e},max:function(t){var e=-1/0;for(var i in t)t[i]>e&&(e=t[i]);return e},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(t){var e=Object.create(C.Observer),i=new XMLHttpRequest,a=!1;return i.open(t.method||"GET",t.url,!0),i.responseType=t.responseType||"json",i.addEventListener("progress",function(t){e.fireEvent("progress",t),t.lengthComputable&&t.loaded==t.total&&(a=!0)}),i.addEventListener("load",function(t){a||e.fireEvent("progress",t),e.fireEvent("load",t),200==i.status||206==i.status?e.fireEvent("success",i.response,t):e.fireEvent("error",t)}),i.addEventListener("error",function(t){e.fireEvent("error",t)}),i.send(),e.xhr=i,e}},C.Observer={on:function(t,e){return this.handlers||(this.handlers={}),(this.handlers[t]||(this.handlers[t]=[])).push(e),{name:t,callback:e,un:this.un.bind(this,t,e)}},un:function(t,e){if(this.handlers){var i=this.handlers[t];if(i)if(e)for(var a=i.length-1;0<=a;a--)i[a]==e&&i.splice(a,1);else i.length=0}},unAll:function(){this.handlers=null},once:function(t,e){var i=this,a=function(){e.apply(this,arguments),setTimeout(function(){i.un(t,a)},0)};return this.on(t,a)},fireEvent:function(t){var e,i;this.handlers&&(e=this.handlers[t],i=Array.prototype.slice.call(arguments,1),e&&e.forEach(function(t){t.apply(null,i)}))}},C.util.extend(C,C.Observer),C.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return C.WebAudio.audioContext||(C.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),C.WebAudio.audioContext},getOfflineAudioContext:function(t){return C.WebAudio.offlineAudioContext||(C.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,t)),C.WebAudio.offlineAudioContext},init:function(t){this.params=t,this.ac=t.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(C.WebAudio.state.playing),Object.create(C.WebAudio.state.paused),Object.create(C.WebAudio.state.finished)],this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(this.PAUSED_STATE),this.setPlaybackRate(this.params.audioRate),this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(t){t&&t.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(t){this.state!==this.states[t]&&(this.state=this.states[t],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(t){this.disconnectFilters(),t&&t.length&&(this.filters=t,this.analyser.disconnect(),t.reduce(function(t,e){return t.connect(e),e},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(this.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(this.scriptBufferSize),this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var e=this;this.scriptNode.onaudioprocess=function(){var t=e.getCurrentTime();t>=e.getDuration()?(e.setState(e.FINISHED_STATE),e.fireEvent("pause")):t>=e.scheduledPause?e.pause():e.state===e.states[e.PLAYING_STATE]&&e.fireEvent("audioprocess",t)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(t){this.gainNode.gain.value=t},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(t,e,i){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(t,function(t){e(t)}.bind(this),i)},setPeaks:function(t){this.peaks=t},setLength:function(t){if(!this.mergedPeaks||t!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];for(var e=this.buffer?this.buffer.numberOfChannels:1,i=0;i<e;i++)this.splitPeaks[i]=[],this.splitPeaks[i][2*(t-1)]=0,this.splitPeaks[i][2*(t-1)+1]=0;this.mergedPeaks[2*(t-1)]=0,this.mergedPeaks[2*(t-1)+1]=0}},getPeaks:function(t,e,i){if(this.peaks)return this.peaks;this.setLength(t);for(var a=this.buffer.length/t,s=~~(a/10)||1,r=this.buffer.numberOfChannels,n=0;n<r;n++)for(var o=this.splitPeaks[n],h=this.buffer.getChannelData(n),l=e;l<=i;l++){for(var c=~~(l*a),u=~~(c+a),d=0,p=0,f=c;f<u;f+=s){var m=h[f];p<m&&(p=m),m<d&&(d=m)}o[2*l]=p,o[2*l+1]=d,(0==n||p>this.mergedPeaks[2*l])&&(this.mergedPeaks[2*l]=p),(0==n||d<this.mergedPeaks[2*l+1])&&(this.mergedPeaks[2*l+1]=d)}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:C.WebAudio.audioContext=null,C.WebAudio.offlineAudioContext=null)},load:function(t){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=t,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(t,e){if(this.buffer)return(this.scheduledPause=null)==t&&(t=this.getCurrentTime())>=this.getDuration()&&(t=0),null==e&&(e=this.getDuration()),this.startPosition=t,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:t,end:e}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(t,e){var i;this.buffer&&(this.createSource(),t=(i=this.seekTo(t,e)).start,e=i.end,this.scheduledPause=e,this.source.start(0,t,e-t),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play"))},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE),this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(t){t=t||1,this.isPaused()?this.playbackRate=t:(this.pause(),this.playbackRate=t,this.play())}},C.WebAudio.state={},C.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},C.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition}},C.WebAudio.state.finished={init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},C.util.extend(C.WebAudio,C.Observer),C.MediaElement=Object.create(C.WebAudio),C.util.extend(C.MediaElement,{init:function(t){this.params=t,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=t.mediaType.toLowerCase(),this.elementPosition=t.elementPosition,this.setPlaybackRate(this.params.audioRate),this.createTimer()},createTimer:function(){var t=this,e=function(){t.isPaused()||(t.fireEvent("audioprocess",t.getCurrentTime()),(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(e))};this.on("play",e)},load:function(t,e,i,a){var s=document.createElement(this.mediaType);s.controls=this.params.mediaControls,s.autoplay=this.params.autoplay||!1,s.preload=null==a?"auto":a,s.src=t,s.style.width="100%";var r=e.querySelector(this.mediaType);r&&e.removeChild(r),e.appendChild(s),this._load(s,i)},loadElt:function(t,e){var i=t;i.controls=this.params.mediaControls,i.autoplay=this.params.autoplay||!1,this._load(i,e)},_load:function(t,e){var i=this;"function"==typeof t.load&&t.load(),t.addEventListener("error",function(){i.fireEvent("error","Error loading media element")}),t.addEventListener("canplay",function(){i.fireEvent("canplay")}),t.addEventListener("ended",function(){i.fireEvent("finish")}),this.media=t,this.peaks=e,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var t=(this.buffer||this.media).duration;return 1/0<=t&&(t=this.media.seekable.end(0)),t},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},getPlaybackRate:function(){return this.playbackRate||this.media.playbackRate},setPlaybackRate:function(t){this.playbackRate=t||1,this.media.playbackRate=this.playbackRate},seekTo:function(t){null!=t&&(this.media.currentTime=t),this.clearPlayEnd()},play:function(t,e){this.seekTo(t),this.media.play(),e&&this.setPlayEnd(e),this.fireEvent("play")},pause:function(){this.media&&this.media.pause(),this.clearPlayEnd(),this.fireEvent("pause")},setPlayEnd:function(e){var i=this;this.onPlayEnd=function(t){e<=t&&(i.pause(),i.seekTo(e))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(t,e,i){return this.buffer?C.WebAudio.getPeaks.call(this,t,e,i):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(t){this.media.volume=t},destroy:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),C.AudioElement=C.MediaElement,C.Drawer={init:function(t,e){this.container=t,this.params=e,this.width=0,this.height=e.height*this.params.pixelRatio,this.lastPos=0,this.initDrawer(e),this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(t,e){e||t.preventDefault();var i,a=t.targetTouches?t.targetTouches[0].clientX:t.clientX,s=this.wrapper.getBoundingClientRect(),r=this.width,n=this.getWidth();return!this.params.fillParent&&r<n?1<(i=(a-s.left)*this.params.pixelRatio/r||0)&&(i=1):i=(a-s.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,i},setupWrapperEvents:function(){var a=this;this.wrapper.addEventListener("click",function(t){var e=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(0!=e){var i=a.wrapper.getBoundingClientRect();if(t.clientY>=i.bottom-e)return}a.params.interact&&a.fireEvent("click",t,a.handleEvent(t))}),this.wrapper.addEventListener("scroll",function(t){a.fireEvent("scroll",t)})},drawPeaks:function(t,e,i,a){this.setWidth(e),this.params.barWidth?this.drawBars(t,0,i,a):this.drawWave(t,0,i,a)},style:function(e,i){return Object.keys(i).forEach(function(t){e.style[t]!==i[t]&&(e.style[t]=i[t])}),e},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(t){var e=this.wrapper.scrollWidth*t;this.recenterOnPosition(e,!0)},recenterOnPosition:function(t,e){var i=this.wrapper.scrollLeft,a=~~(this.wrapper.clientWidth/2),s=t-a,r=s-i,n=this.wrapper.scrollWidth-this.wrapper.clientWidth;0!=n&&(!e&&-a<=r&&r<a&&(s=i+(r=Math.max(-5,Math.min(5,r)))),(s=Math.max(0,Math.min(n,s)))!=i&&(this.wrapper.scrollLeft=s))},getScrollX:function(){return Math.round(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(t){this.width!=t&&(this.width=t,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(t){t!=this.height&&(this.height=t,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(t){var e,i=1/this.params.pixelRatio,a=Math.round(t*this.width)*i;(a<this.lastPos||a-this.lastPos>=i)&&(this.lastPos=a,this.params.scrollParent&&this.params.autoCenter&&(e=~~(this.wrapper.scrollWidth*t),this.recenterOnPosition(e)),this.updateProgress(a))},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(t,e){},clearWave:function(){},updateProgress:function(t){}},C.util.extend(C.Drawer,C.Observer),C.Drawer.Canvas=Object.create(C.Drawer),C.util.extend(C.Drawer.Canvas,{createElements:function(){var t,e=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0}));this.waveCc=e.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor&&(t=this.progressWave.appendChild(document.createElement("canvas")),this.progressCc=t.getContext("2d"))},updateSize:function(){var t=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:t+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:t+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:function(s,t,r,n){var i=this;if(s[0]instanceof Array){var e=s;if(this.params.splitChannels)return this.setHeight(e.length*this.params.height*this.params.pixelRatio),void e.forEach(function(t,e){i.drawBars(t,e,r,n)});s=e[0]}var a=[].some.call(s,function(t){return t<0}),o=1;a&&(o=2);var h,l,c=.5/this.params.pixelRatio,u=this.width,d=this.params.height*this.params.pixelRatio,p=d*t||0,f=d/2,m=s.length/o,g=this.params.barWidth*this.params.pixelRatio,v=Math.max(this.params.pixelRatio,~~(g/2)),y=g+v,w=1/this.params.barHeight;this.params.normalize&&(h=C.util.max(s),l=C.util.min(s),w=h<-l?-l:h);var b=m/u;this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(t){if(t)for(var e=r/b;e<n/b;e+=y){var i=s[Math.floor(e*b*o)]||0,a=Math.round(i/w*f);t.fillRect(e+c,f-a+p,g+c,2*a)}},this)},drawWave:function(a,t,s,r){var i=this;if(a[0]instanceof Array){var e=a;if(this.params.splitChannels)return this.setHeight(e.length*this.params.height*this.params.pixelRatio),void e.forEach(function(t,e){i.drawWave(t,e,s,r)});a=e[0]}if(![].some.call(a,function(t){return t<0})){for(var n=[],o=0,h=a.length;o<h;o++)n[2*o]=a[o],n[2*o+1]=-a[o];a=n}var l=.5/this.params.pixelRatio,c=this.params.height*this.params.pixelRatio,u=c*t||0,d=c/2,p=~~(a.length/2),f=1;this.params.fillParent&&this.width!=p&&(f=this.width/p);var m,g,v=1/this.params.barHeight;this.params.normalize&&(m=C.util.max(a),g=C.util.min(a),v=m<-g?-g:m),this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(t){if(t){t.beginPath(),t.moveTo(s*f+l,d+u);for(var e=s;e<r;e++){var i=Math.round(a[2*e]/v*d);t.lineTo(e*f+l,d-i+u)}for(e=r-1;s<=e;e--){i=Math.round(a[2*e+1]/v*d);t.lineTo(e*f+l,d-i+u)}t.closePath(),t.fill(),t.fillRect(0,d+u-l,this.width,l)}},this)},updateProgress:function(t){this.style(this.progressWave,{width:t+"px"})},getImage:function(t,e){return this.waveCc.canvas.toDataURL(t,e)}}),C.Drawer.MultiCanvas=Object.create(C.Drawer),C.util.extend(C.Drawer.MultiCanvas,{initDrawer:function(t){if(this.maxCanvasWidth=null!=t.maxCanvasWidth?t.maxCanvasWidth:4e3,this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio),this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.addCanvas()},updateSize:function(){for(var t=Math.round(this.width/this.params.pixelRatio),e=Math.ceil(t/this.maxCanvasElementWidth);this.canvases.length<e;)this.addCanvas();for(;this.canvases.length>e;)this.removeCanvas();for(var i in this.canvases){var a=this.maxCanvasWidth+2*Math.ceil(this.params.pixelRatio/2);i==this.canvases.length-1&&(a=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(this.canvases[i],a,this.height),this.clearWaveForEntry(this.canvases[i])}},addCanvas:function(){var t={},e=this.maxCanvasElementWidth*this.canvases.length;t.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:e+"px",top:0,bottom:0,height:"100%"})),t.waveCtx=t.wave.getContext("2d"),this.hasProgressCanvas&&(t.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:e+"px",top:0,bottom:0,height:"100%"})),t.progressCtx=t.progress.getContext("2d")),this.canvases.push(t)},removeCanvas:function(){var t=this.canvases.pop();t.wave.parentElement.removeChild(t.wave),this.hasProgressCanvas&&t.progress.parentElement.removeChild(t.progress)},updateDimensions:function(t,e,i){var a=Math.round(e/this.params.pixelRatio),s=Math.round(this.width/this.params.pixelRatio);t.start=t.waveCtx.canvas.offsetLeft/s||0,t.end=t.start+a/s,t.waveCtx.canvas.width=e,t.waveCtx.canvas.height=i,this.style(t.waveCtx.canvas,{width:a+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(t.progressCtx.canvas.width=e,t.progressCtx.canvas.height=i,this.style(t.progressCtx.canvas,{width:a+"px"}))},clearWave:function(){for(var t in this.canvases)this.clearWaveForEntry(this.canvases[t])},clearWaveForEntry:function(t){t.waveCtx.clearRect(0,0,t.waveCtx.canvas.width,t.waveCtx.canvas.height),this.hasProgressCanvas&&t.progressCtx.clearRect(0,0,t.progressCtx.canvas.width,t.progressCtx.canvas.height)},drawBars:function(t,e,i,a){var s=this;if(t[0]instanceof Array){var r=t;if(this.params.splitChannels)return this.setHeight(r.length*this.params.height*this.params.pixelRatio),void r.forEach(function(t,e){s.drawBars(t,e,i,a)});t=r[0]}var n=1;[].some.call(t,function(t){return t<0})&&(n=2);var o,h,l=this.width,c=this.params.height*this.params.pixelRatio,u=c*e||0,d=c/2,p=t.length/n,f=this.params.barWidth*this.params.pixelRatio,m=f+Math.max(this.params.pixelRatio,~~(f/2)),g=1/this.params.barHeight;this.params.normalize&&(g=(o=C.util.max(t))<-(h=C.util.min(t))?-h:o);for(var v=p/l,y=i/v;y<a/v;y+=m){var w=t[Math.floor(y*v*n)]||0,b=Math.round(w/g*d);this.fillRect(y+this.halfPixel,d-b+u,f+this.halfPixel,2*b)}},drawWave:function(t,e,i,a){var s=this;if(t[0]instanceof Array){var r=t;if(this.params.splitChannels)return this.setHeight(r.length*this.params.height*this.params.pixelRatio),void r.forEach(function(t,e){s.drawWave(t,e,i,a)});t=r[0]}if(![].some.call(t,function(t){return t<0})){for(var n=[],o=0,h=t.length;o<h;o++)n[2*o]=t[o],n[2*o+1]=-t[o];t=n}var l,c,u=this.params.height*this.params.pixelRatio,d=u*e||0,p=u/2,f=1/this.params.barHeight;this.params.normalize&&(f=(l=C.util.max(t))<-(c=C.util.min(t))?-c:l),this.drawLine(t,f,p,d,i,a),this.fillRect(0,p+d-this.halfPixel,this.width,this.halfPixel)},drawLine:function(t,e,i,a,s,r){for(var n in this.canvases){var o=this.canvases[n];this.setFillStyles(o),this.drawLineToContext(o,o.waveCtx,t,e,i,a,s,r),this.drawLineToContext(o,o.progressCtx,t,e,i,a,s,r)}},drawLineToContext:function(t,e,i,a,s,r,n,o){if(e){var h=i.length/2,l=1;this.params.fillParent&&this.width!=h&&(l=this.width/h);var c=Math.round(h*t.start),u=Math.round(h*t.end);if(!(o<c||u<n)){var d=Math.max(c,n),p=Math.min(u,o);e.beginPath(),e.moveTo((d-c)*l+this.halfPixel,s+r);for(var f=d;f<p;f++){var m=i[2*f]||0,g=Math.round(m/a*s);e.lineTo((f-c)*l+this.halfPixel,s-g+r)}for(f=p-1;d<=f;f--){m=i[2*f+1]||0,g=Math.round(m/a*s);e.lineTo((f-c)*l+this.halfPixel,s-g+r)}e.closePath(),e.fill()}}},fillRect:function(t,e,i,a){for(var s=Math.floor(t/this.maxCanvasWidth),r=Math.min(Math.ceil((t+i)/this.maxCanvasWidth)+1,this.canvases.length),n=s;n<r;n++){var o=this.canvases[n],h=n*this.maxCanvasWidth,l={x1:Math.max(t,n*this.maxCanvasWidth),y1:e,x2:Math.min(t+i,n*this.maxCanvasWidth+o.waveCtx.canvas.width),y2:e+a};l.x1<l.x2&&(this.setFillStyles(o),this.fillRectToContext(o.waveCtx,l.x1-h,l.y1,l.x2-l.x1,l.y2-l.y1),this.fillRectToContext(o.progressCtx,l.x1-h,l.y1,l.x2-l.x1,l.y2-l.y1))}},fillRectToContext:function(t,e,i,a,s){t&&t.fillRect(e,i,a,s)},setFillStyles:function(t){t.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(t.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(t){this.style(this.progressWave,{width:t+"px"})},getImage:function(e,i){var a=[];return this.canvases.forEach(function(t){a.push(t.wave.toDataURL(e,i))}),1<a.length?a:a[0]}}),C.Drawer.SplitWavePointPlot=Object.create(C.Drawer.Canvas),C.util.extend(C.Drawer.SplitWavePointPlot,{defaultPlotParams:{plotNormalizeTo:"whole",plotTimeStart:0,plotMin:0,plotMax:1,plotColor:"#f63",plotProgressColor:"#F00",plotPointHeight:2,plotPointWidth:2,plotSeparator:!0,plotSeparatorColor:"black",plotRangeDisplay:!1,plotRangeUnits:"",plotRangePrecision:4,plotRangeIgnoreOutliers:!1,plotRangeFontSize:12,plotRangeFontType:"Ariel",waveDrawMedianLine:!0,plotFileDelimiter:"\t"},plotTimeStart:0,plotTimeEnd:-1,plotArrayLoaded:!1,plotArray:[],plotPoints:[],plotMin:0,plotMax:1,initDrawer:function(t){var e=this;for(var i in this.defaultPlotParams)void 0===this.params[i]&&(this.params[i]=this.defaultPlotParams[i]);this.plotTimeStart=this.params.plotTimeStart,void 0!==this.params.plotTimeEnd&&(this.plotTimeEnd=this.params.plotTimeEnd),Array.isArray(t.plotArray)?(this.plotArray=t.plotArray,this.plotArrayLoaded=!0):this.loadPlotArrayFromFile(t.plotFileUrl,function(t){e.plotArray=t,e.plotArrayLoaded=!0,e.fireEvent("plot_array_loaded")},this.params.plotFileDelimiter)},drawPeaks:function(t,e,i,a){var s;1==this.plotArrayLoaded?(this.setWidth(e),this.splitChannels=!0,this.params.height=this.params.height/2,t[0]instanceof Array&&(t=t[0]),this.params.barWidth?this.drawBars(t,1,i,a):this.drawWave(t,1,i,a),this.params.height=2*this.params.height,this.calculatePlots(),this.drawPlots()):(s=this).on("plot-array-loaded",function(){s.drawPeaks(t,e,i,a)})},drawPlots:function(){var t=this.params.height*this.params.pixelRatio/2,e=.5/this.params.pixelRatio;for(var i in this.waveCc.fillStyle=this.params.plotColor,this.progressCc&&(this.progressCc.fillStyle=this.params.plotProgressColor),this.plotPoints){var a=parseInt(i),s=t-this.params.plotPointHeight-this.plotPoints[i]*(t-this.params.plotPointHeight),r=this.params.plotPointHeight;this.waveCc.fillRect(a,s,this.params.plotPointWidth,r),this.progressCc&&this.progressCc.fillRect(a,s,this.params.plotPointWidth,r)}this.params.plotSeparator&&(this.waveCc.fillStyle=this.params.plotSeparatorColor,this.waveCc.fillRect(0,t,this.width,e)),this.params.plotRangeDisplay&&this.displayPlotRange()},displayPlotRange:function(){var t=this.params.plotRangeFontSize*this.params.pixelRatio,e=this.plotMax.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits,i=this.plotMin.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits;this.waveCc.font=t.toString()+"px "+this.params.plotRangeFontType,this.waveCc.fillText(e,3,t),this.waveCc.fillText(i,3,this.height/2)},calculatePlots:function(){this.plotPoints={},this.calculatePlotTimeEnd();for(var t=[],e=-1,i=0,a=99999999999999,s=0,r=99999999999999,n=this.plotTimeEnd-this.plotTimeStart,o=0;o<this.plotArray.length;o++){var h,l,c=this.plotArray[o];c.value>i&&(i=c.value),c.value<a&&(a=c.value),c.time>=this.plotTimeStart&&c.time<=this.plotTimeEnd&&(h=Math.round(this.width*(c.time-this.plotTimeStart)/n),t.push(c.value),h!==e&&0<t.length&&(s<(l=this.avg(t))&&(s=l),l<r&&(r=l),this.plotPoints[e]=l,t=[]),e=h)}"whole"==this.params.plotNormalizeTo?(this.plotMin=a,this.plotMax=i):"values"==this.params.plotNormalizeTo?(this.plotMin=this.params.plotMin,this.plotMax=this.params.plotMax):(this.plotMin=r,this.plotMax=s),this.normalizeValues()},normalizeValues:function(){var t={};if("none"!==this.params.plotNormalizeTo){for(var e in this.plotPoints){var i=(this.plotPoints[e]-this.plotMin)/(this.plotMax-this.plotMin);1<i?this.params.plotRangeIgnoreOutliers||(t[e]=1):i<0?this.params.plotRangeIgnoreOutliers||(t[e]=0):t[e]=i}this.plotPoints=t}},loadPlotArrayFromFile:function(t,s,r){void 0===r&&(r="\t");var n=[],e={url:t,responseType:"text"};C.util.ajax(e).on("load",function(t){if(200==t.currentTarget.status){for(var e=t.currentTarget.responseText.split("\n"),i=0;i<e.length;i++){var a=e[i].split(r);2==a.length&&n.push({time:parseFloat(a[0]),value:parseFloat(a[1])})}s(n)}})},calculatePlotTimeEnd:function(){void 0!==this.params.plotTimeEnd?this.plotTimeEnd=this.params.plotTimeEnd:this.plotTimeEnd=this.plotArray[this.plotArray.length-1].time},avg:function(t){return t.reduce(function(t,e){return t+e})/t.length}}),C.util.extend(C.Drawer.SplitWavePointPlot,C.Observer),C.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[],this.peakCacheLength=-1},addRangeToPeakCache:function(t,e,i){t!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=t);for(var a=[],s=0;s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<e;)s++;for(s%2==0&&a.push(e);s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<=i;)a.push(this.peakCacheRanges[s]),s++;s%2==0&&a.push(i),a=a.filter(function(t,e,i){return 0==e?t!=i[e+1]:e==i.length-1?t!=i[e-1]:t!=i[e-1]&&t!=i[e+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(a),this.peakCacheRanges=this.peakCacheRanges.sort(function(t,e){return t-e}).filter(function(t,e,i){return 0==e?t!=i[e+1]:e==i.length-1?t!=i[e-1]:t!=i[e-1]&&t!=i[e+1]});for(var r=[],s=0;s<a.length;s+=2)r.push([a[s],a[s+1]]);return r},getCacheRanges:function(){for(var t=[],e=0;e<this.peakCacheRanges.length;e+=2)t.push([this.peakCacheRanges[e],this.peakCacheRanges[e+1]]);return t}},"complete"===document.readyState?t():window.addEventListener("load",t),C}),function(t){"function"==typeof define&&define.amd?define("pat-wavesurfer",["jquery","pat-base","pat-registry","pat-parser","pat-logger","wavesurfer"],function(){return t.apply(this,arguments)}):t($,patterns.Base,patterns,patterns.Parser,patterns.logger,patterns.wavesurfer)}(function(i,t,e,a,s,r){"use strict";var n=s.getLogger("pat-wavesurfer");n.debug("pattern loaded");var o=new a("wavesurfer");return o.addArgument("url",void 0),o.addArgument("peaks",void 0),o.addArgument("height",128),o.addArgument("waveColor","#999"),o.addArgument("progressColor","#555"),o.addArgument("cursorColor","#333"),o.addArgument("cursorWidth",1),o.addArgument("barHeight",1),o.addArgument("barWidth",void 0),o.addArgument("fillParent",!0),o.addArgument("minPxPerSec",50),o.addArgument("maxCanvasWidth",4e3),o.addArgument("renderer","Canvas"),o.addArgument("hideScrollbar",!1),o.addArgument("responsive",!0),o.addArgument("scrollParent",!1),o.addArgument("interact",!0),o.addArgument("pixelRatio",window.devicePixelRatio),o.addArgument("autoCenter",!0),o.addArgument("audioRate",1),o.addArgument("normalize",!1),o.addArgument("skipLength",2),o.addArgument("backend","WebAudio"),o.addArgument("mediaType","audio"),i("[data-pat-wavesurfer]").each(function(){o.parse(i(this))}),t.extend({name:"wavesurfer",trigger:".pat-wavesurfer",init:function(){var t=this.options=o.parse(this.$el),e=WaveSurfer.create({container:this.$el.find(".waveformWrapper")[0],peaks:t.peaks,height:t.height,waveColor:t.waveColor,progressColor:t.progressColor,cursorColor:t.cursorColor,cursorWidth:t.cursorWidth,barHeight:t.barHeight,barWidth:t.barWidth,fillParent:t.fillParent,minPxPerSec:t.minPxPerSec,maxCanvasWidth:t.maxCanvasWidth,renderer:t.renderer,hideScrollbar:t.hideScrollbar,responsive:t.responsive,scrollParent:t.scrollParent,interact:t.interact,pixelRatio:t.pixelRatio,autoCenter:t.autoCenter,audioRate:t.audioRate,normalize:t.normalize,skipLength:t.skipLength,backend:t.backend,mediaType:t.mediaType});e.load(t.url,JSON.parse(t.peaks)),i(this.$el.find(".controlsContainer")).prepend('<div class="playerControls">                                <div class="btn btnPlay">                                </div>                              </div>'),i(this.$el.find(".playerControls .btnPlay")).bind("click",function(){e.setVolume(.5),e.isPlaying()?(e.pause(),i(this).removeClass("active")):(i(".pat-wavesurfer").each(function(){i(this).data("wavesurfer").pause(),i(this).find(".btnPlay").removeClass("active")}),e.play(),i(this).addClass("active"))}),this.$el.data("wavesurfer",e),n.debug("pattern initialized")}})}),require(["jquery","pat-base","pat-registry","pat-parser","pat-logger","pat-wavesurfer","wavesurfer"],function(){}),define("/Users/peter/workspace/phonogen/buildout/srcphonogen/collective.wavesurfer/src/collective/wavesurfer/browser/static/wavesurfer-bundle.js",function(){});
//# sourceMappingURL=wavesurfer-bundle-compiled.js.map